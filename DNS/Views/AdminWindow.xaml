<Window x:Class="DNS.Views.AdminWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:converters="clr-namespace:DNS.Converters"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        mc:Ignorable="d"
        Title="Панель администратора" 
        Height="800" 
        Width="1200"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource MaterialDesignWindow}">

    <Window.Resources>
        <converters:ImagePathConverter x:Key="ImagePathConverter"/>
        <converters:OrderStatusConverter x:Key="OrderStatusConverter"/>
        <converters:OrderStatusToColorConverter x:Key="OrderStatusToColorConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TabControl Grid.Row="1" Style="{StaticResource MaterialDesignNavigatilRailTabControl}">
            <!-- Вкладка Товары -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="Package" Width="24" Height="24"/>
                        <TextBlock Text="Товары"/>
                    </StackPanel>
                </TabItem.Header>
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <Button Content="Добавить товар"
                                Click="OnAddProductButtonClick"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Margin="0,0,8,0"/>
                        <Button Content="Изменить"
                                Click="OnEditProductButtonClick"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,0,8,0"/>
                        <Button Content="Удалить"
                                Click="OnDeleteProductButtonClick"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,0,8,0"/>
                        <Button Content="Обновить"
                                Click="OnRefreshButtonClick"
                                Style="{StaticResource MaterialDesignOutlinedButton}"/>
                    </StackPanel>

                    <DataGrid x:Name="ProductsDataGrid"
                             Grid.Row="1"
                             AutoGenerateColumns="False"
                             IsReadOnly="True"
                             Style="{StaticResource MaterialDesignDataGrid}">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Фото" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Image Source="{Binding ImageUrl, Converter={StaticResource ImagePathConverter}}" 
                                               Height="50" 
                                               Width="50"
                                               Stretch="Uniform"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Название" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Категория" Binding="{Binding Category.Name}" Width="Auto"/>
                            <DataGridTextColumn Header="Цена" Binding="{Binding Price, StringFormat={}{0:N2} ₽}" Width="Auto"/>
                            <DataGridTextColumn Header="На складе" Binding="{Binding StockQuantity}" Width="Auto"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Вкладка Категории -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="Category" Width="24" Height="24"/>
                        <TextBlock Text="Категории"/>
                    </StackPanel>
                </TabItem.Header>
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <Button Content="Добавить категорию"
                                Click="OnAddCategoryButtonClick"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Margin="0,0,8,0"/>
                        <Button Content="Удалить"
                                Click="OnDeleteCategoryButtonClick"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,0,8,0"/>
                        <Button Content="Обновить"
                                Click="OnRefreshButtonClick"
                                Style="{StaticResource MaterialDesignOutlinedButton}"/>
                    </StackPanel>

                    <DataGrid x:Name="CategoriesDataGrid"
                             Grid.Row="1"
                             AutoGenerateColumns="False"
                             IsReadOnly="True"
                             Style="{StaticResource MaterialDesignDataGrid}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Название" Binding="{Binding Name}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Вкладка Заказы -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="CartCheck" Width="24" Height="24"/>
                        <TextBlock Text="Заказы"/>
                    </StackPanel>
                </TabItem.Header>
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <Button Content="Просмотр"
                                Click="OnViewOrderButtonClick"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Margin="0,0,8,0"/>
                        <Button Content="Изменить статус"
                                Click="OnUpdateOrderStatusButtonClick"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                Margin="0,0,8,0"/>
                        <Button Content="Обновить"
                                Click="OnRefreshButtonClick"
                                Style="{StaticResource MaterialDesignOutlinedButton}"/>
                    </StackPanel>

                    <DataGrid x:Name="OrdersDataGrid"
                             Grid.Row="1"
                             AutoGenerateColumns="False"
                             IsReadOnly="True"
                             Style="{StaticResource MaterialDesignDataGrid}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Номер" Binding="{Binding Id}" Width="Auto"/>
                            <DataGridTextColumn Header="Дата" Binding="{Binding OrderDate, StringFormat=dd.MM.yyyy HH:mm}" Width="Auto"/>
                            <DataGridTemplateColumn Header="Статус" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Status, Converter={StaticResource OrderStatusConverter}}"
                                                 Foreground="{Binding Status, Converter={StaticResource OrderStatusToColorConverter}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Сумма" Binding="{Binding TotalAmount, StringFormat={}{0:N2} ₽}" Width="Auto"/>
                            <DataGridTextColumn Header="Покупатель" Binding="{Binding User.Username}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Вкладка Статистика -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="ChartBar" Width="24" Height="24"/>
                        <TextBlock Text="Статистика"/>
                    </StackPanel>
                </TabItem.Header>
                <ScrollViewer>
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Карточки со статистикой -->
                        <WrapPanel Grid.Row="0" Margin="0,0,0,16">
                            <materialDesign:Card Margin="8" Width="200">
                                <StackPanel Margin="8">
                                    <TextBlock Text="Заказов сегодня"
                                             Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                                    <TextBlock x:Name="TodayOrdersCount"
                                             Text="0"
                                             Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                                             Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                                </StackPanel>
                            </materialDesign:Card>

                            <materialDesign:Card Margin="8" Width="200">
                                <StackPanel Margin="8">
                                    <TextBlock Text="Выручка сегодня"
                                             Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                                    <TextBlock x:Name="TodayRevenue"
                                             Text="0 ₽"
                                             Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                                             Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                                </StackPanel>
                            </materialDesign:Card>

                            <materialDesign:Card Margin="8" Width="200">
                                <StackPanel Margin="8">
                                    <TextBlock Text="Всего товаров"
                                             Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                                    <TextBlock x:Name="TotalProducts"
                                             Text="0"
                                             Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                                             Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                                </StackPanel>
                            </materialDesign:Card>

                            <materialDesign:Card Margin="8" Width="200">
                                <StackPanel Margin="8">
                                    <TextBlock Text="Активных пользователей"
                                             Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                                    <TextBlock x:Name="ActiveUsers"
                                             Text="0"
                                             Style="{StaticResource MaterialDesignHeadline4TextBlock}"
                                             Foreground="{DynamicResource PrimaryHueDarkBrush}"/>
                                </StackPanel>
                            </materialDesign:Card>
                        </WrapPanel>

                        <!-- Графики -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- График продаж по дням -->
                            <materialDesign:Card Grid.Column="0" Margin="8">
                                <Grid Margin="16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="300"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="Продажи за последние 7 дней"
                                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                             Margin="0,0,0,16"/>
                                    <lvc:CartesianChart Grid.Row="1" 
                                                       x:Name="SalesChart"
                                                       Series="{Binding SalesChartData}"
                                                       LegendLocation="Right">
                                        <lvc:CartesianChart.AxisX>
                                            <lvc:Axis Title="Дата" 
                                                     Labels="{Binding SalesChartLabels}"/>
                                        </lvc:CartesianChart.AxisX>
                                        <lvc:CartesianChart.AxisY>
                                            <lvc:Axis Title="Сумма (₽)" 
                                                     LabelFormatter="{Binding SalesYFormatter}"/>
                                        </lvc:CartesianChart.AxisY>
                                    </lvc:CartesianChart>
                                </Grid>
                            </materialDesign:Card>

                            <!-- График популярных категорий -->
                            <materialDesign:Card Grid.Column="1" Margin="8">
                                <Grid Margin="16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="300"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="Популярные категории"
                                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                             Margin="0,0,0,16"/>
                                    <lvc:PieChart Grid.Row="1" 
                                                 x:Name="CategoriesChart"
                                                 Series="{Binding CategoriesChartData}"
                                                 LegendLocation="Bottom"/>
                                </Grid>
                            </materialDesign:Card>
                        </Grid>

                        <!-- График продаж по месяцам -->
                        <materialDesign:Card Grid.Row="2" Margin="8">
                            <Grid Margin="16">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="300"/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="Продажи по месяцам"
                                         Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                         Margin="0,0,0,16"/>
                                <lvc:CartesianChart Grid.Row="1" 
                                                   x:Name="MonthlySalesChart"
                                                   Series="{Binding MonthlySalesChartData}"
                                                   LegendLocation="Right">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Месяц" 
                                                 Labels="{Binding MonthlySalesChartLabels}"/>
                                    </lvc:CartesianChart.AxisX>
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="Сумма (₽)" 
                                                 LabelFormatter="{Binding MonthlySalesYFormatter}"/>
                                    </lvc:CartesianChart.AxisY>
                                </lvc:CartesianChart>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
